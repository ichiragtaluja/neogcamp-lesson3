<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ZIM - Code Creativity</title>

    <!--
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ZIM Zapps
Progressive Web App (PWA) tool output from
https://zimjs.com/zapps 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->

    <!-- ZIM PWA STEP 1 - MANIFEST -->
    <link rel="manifest" href="manifest.json" />

    <!-- ZIM PWA STEP 2 - META -->
    <meta name="apple-mobile-web-app-title" content="pwa" />
    <meta name="theme-color" content="#333333" />
    <meta name="msapplication-TileColor" content="#333333" />

    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <link rel="apple-touch-icon" href="icons/icon_152.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="msapplication-TileImage" content="icons/icon_144.png" />

    <!-- should have faveicons - see link below -->
    <!-- see https://www.favicon-generator.org/ -->

    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="msapplication-starturl" content="./" />

    <!-- ZIM PWA STEP 3 - SERVICE WORKER -->
    <script>
      window.addEventListener("DOMContentLoaded", function () {
        if (location.protocol === "https:" && "serviceWorker" in navigator)
          navigator.serviceWorker.register("./serviceworker.js");
      });
    </script>

    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script src="libraries/createjs.js"></script>
    <script src="libraries/zim_min.js"></script>
    <script src="libraries/socket.io.js"></script>
    <script src="libraries/zimsocket_1.1.js"></script>
    <!-- <script src="libraries/zim_socket"></script> -->
    <script src="libraries/zimserver_urls.js"></script>
    <!-- <script>
      // FOR PWA
      // https://zimjs.com/zapps.html
      // must be an index.html in app directory

      // import zim from "https://zimjs.org/cdn/016/zim";
      new Frame(FULL, null, null, light, dark, ready);
      function ready() {

	// ZIM PWA STEP 4 - ADD TO HOME SCREEN (A2HS)
	// NOTE: new PWA() works with ZIM Cat 04 or beyond
	// Message shows if only if running from mobile Browser
	// See https://zimjs.com/docs.html?item=PWA for more options

	new PWA(runZapp);
	function runZapp() {
	        // Given F, S, W, H or frame, stage, stageW, stageH
	
	        new Circle(100, blue).center().drag();
	} // end runZapp

      } // end ready
    </script> -->
    <!-- <script>
      // import zim from "libraries/zim_socket";

      new Frame(FIT, 1024, 768, light, dark, ready);
      function ready() {
        // ZIM PWA STEP 4 - ADD TO HOME SCREEN (A2HS)
        // NOTE: new PWA() works with ZIM Cat 04 or beyond
        // Message shows if only if running from mobile Browser
        // See https://zimjs.com/docs.html?item=PWA for more options

        new PWA(runZapp);
        function runZapp() {
          // Given F, S, W, H or frame, stage, stageW, stageH

          //
          // ZIM SOCKET CONTENT - load a second window

          // zimSocketURL comes from the import of zim_socket
          // get the app name here: https://zimjs.com/request.html
          const appName = "shared";
          const socket = new Socket(zimSocketURL, appName);

          socket.on("ready", () => {
            zogg("socket ready");

            const input = new TextInput().loc(50, 50);
            F.on("keydown", (e) => {
              if (e.key == "Enter") {
                const x = rand(W);
                const y = rand(H);
                new Label(input.text).loc(x, y);
                socket.setProperties({
                  text: input.text,
                  textX: x,
                  textY: y,
                });
                input.text = "";
                S.update();
              }
            });

            const ball = new Circle(100, blue).center().drag();

            ball.on("pressmove", () => {
              socket.setProperties({
                x: Math.round(ball.x),
                y: Math.round(ball.y),
              });
            });

            socket.on("data", function (data) {
              // normally, stuff happens in here ;-)
              zogo(data);

              if (data.text) {
                new Label(data.text).loc(data.textX, data.textY);
              }

              let x = socket.getLatestValue("x");
              let y = socket.getLatestValue("y");
              ball.loc(x, y);

              S.update();
            });

            S.update();
          });
        } // end runZapp
      } // end ready
    </script> -->
    <script>
      // import zim from "libraries/zim_socket";

      new Frame(FIT, 1024, 768, light, dark, ready);
      function ready() {
        // ZIM PWA STEP 4 - ADD TO HOME SCREEN (A2HS)
        // NOTE: new PWA() works with ZIM Cat 04 or beyond
        // Message shows if only if running from mobile Browser
        // See https://zimjs.com/docs.html?item=PWA for more options

        new PWA(runZapp);
        function runZapp() {
          // Given F, S, W, H or frame, stage, stageW, stageH

          //
          // ZIM SOCKET CONTENT - load a second window

          // zimSocketURL comes from the import of zim_socket
          // get the app name here: https://zimjs.com/request.html
          const appName = "shared";
          const socket = new Socket(zimSocketURL, appName);

          socket.on("ready", () => {
            zogg("socket ready");
            const chatInput = new TextInput(400)
              .sca(0.8)
              .pos(0, 100, CENTER, BOTTOM);
            const sendButton = new Button(null, null, "Send").pos(
              0,
              10,
              CENTER,
              BOTTOM
            );
            const chatDisplay = new TextArea(600, 400)
              .pos(0, 50)
              .sca(0.8)
              .center();

            sendButton.on("click", () => {
              const message = chatInput.text;
              if (message.trim() !== "") {
                zogb("been here");
                socket.setProperties({ message: message });
                chatInput.text = "";
              }
            });

            // const input = new TextInput().loc(50, 50);
            // F.on("keydown", (e) => {
            //   if (e.key == "Enter") {
            //     const x = rand(W);
            //     const y = rand(H);
            //     new Label(input.text).loc(x, y);
            //     socket.setProperties({
            //       text: input.text,
            //       textX: x,
            //       textY: y,
            //     });
            //     input.text = "";
            //     S.update();
            //   }
            // });

            // const ball = new Circle(100, blue).center().drag();

            // ball.on("pressmove", () => {
            //   socket.setProperties({
            //     x: Math.round(ball.x),
            //     y: Math.round(ball.y),
            //   });
            // });

            // socket.on("data", function (data) {
            //   // normally, stuff happens in here ;-)
            //   zogo(data);

            //   if (data.text) {
            //     new Label(data.text).loc(data.textX, data.textY);
            //   }

            //   let x = socket.getLatestValue("x");
            //   let y = socket.getLatestValue("y");
            //   ball.loc(x, y);

            //   S.update();
            // });
            socket.on("data", (data) => {
              zogr(data);
              if (data.message) {
                chatDisplay.text += data.message + "\n";
                S.update();
              }
            });

            S.update();
          });
        } // end runZapp
      } // end ready
    </script>
  </head>
  <body></body>
</html>
